project-dir: r6-test
config: r6-rproject.toml

test:
  steps:
  - name: "rv init"
    run: "rv init"
    thread: rv

  - name: "start R"
    run: "R"
    thread: r
    assert: "rv libpaths active!"
  
  - name: "R wd"
    run: pwd.R
    thread: r
    assert: "r6-test"
 
  - name: "rv sync"
    run: "rv sync"
    thread: rv
    assert: "+ R6 (2.6.1, binary from https://packagemanager.posit.co/cran/2025-07-10)"
 
  - name: "Load packages"
    run: load_r6.R
    thread: r
    assert: "R6_VERSION: 2.6.1"

  - name: "install old version"
    run: install_old_r6.R
    thread: r

  - name: "load old packages"
    run: load_r6.R
    thread: r
    assert: "R6_VERSION: 2.5.1"
  
  - name: "restart r"
    run: "R"
    thread: r
    restart: true
    assert: "rv libpaths active!"

  - name: "rv plan"
    run: "rv plan"
    thread: rv
    assert: "+ R6"

  - name: "rv sync"
    run: "rv sync"
    thread: rv
    assert:
      - "- R6"
      - "+ R6 (2.6.1, binary from https://packagemanager.posit.co/cran/2025-07-10)"
  
  - name: "load new packages"
    run: load_r6.R
    thread: r
    assert: "R6_VERSION: 2.6.1"
