project-dir: add-test
config: rproject.toml

test:
  steps:
  - name: "start R"
    run: "R"
    thread: r

  - name: "create empty Rprofile"
    run: "init_withoutRprofile.R"
    thread: r

  - name: "rv init"
    run: "rv init"
    thread: rv
    assert:
      - "rv project successfully initialized at ."
      # Currently this won't work as only std out is captured, Matt is working on including std err
      # - "WARNING: Could not set default repositories. Set with your company preferred package URL or public url (i.e. `https://packagemanager.posit.co/cran/latest`)"

  - name: "cleanup test dir"
    run: "cleanup_test_dir.R"
    thread: r

  - name: "create Rprofile with PPM info"
    run: "init_withRprofile.R"
    thread: r

  - name: "rv init"
    run: "rv init"
    thread: rv
    assert:
      contains:
        - "rv project successfully initialized at ."
      not_contains:
        - "WARNING: Could not set default repositories. Set with your company preferred package URL or public url (i.e. `https://packagemanager.posit.co/cran/latest`)"

  - name: "Add packages dplyr ggplot tidyr"
    run: "rv add dplyr ggplot2 tidyr readr"
    thread: rv
    insta: snapshots/new-test-add.snap

  - name: "Add packages readr"
    run: "add_to_toml.R"
    thread: r

  - name: "rv plan"
    run: "rv plan"
    thread: rv
    insta: snapshots/new-test-plan.snap

  - name: "rv sync"
    run: "rv sync"
    thread: rv
    insta: snapshots/new-test-sync.snap

  # - name: "start R"
  #   run: "R"
  #   thread: r
  #   #assert: "rv libpaths active!" - this fails on ubuntu but I don't know why...
  
  # - name: "add pkgs"
  #   run: "rv add dplyr ggplot2 tidyr readr"
  #   thread: rv
  #   insta: snapshots/add-multi.snap

  # - name: "load pkgs"
  #   run: load_all_pkgs.R
  #   thread: r 
  #   assert: 
  #     - "DPLYR_VERSION: 1.1.4"
  #     - "GGPLOT2_VERSION: 3.5.2"
  #     - "TIDYR_VERSION: 1.3.1"
  #     - "READR_VERSION: 2.1.5"



