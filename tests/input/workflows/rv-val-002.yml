project-dir: rv-val-002
config: rv-val.toml

test:
  steps:
  - name: "Start R"
    run: "R"
    thread: r
 
  - name: "install renv"
    run: |
        options("repos" = c("CRAN" = "https://packagemanager.posit.co/cran/2025-07-16"))
        install.packages("renv")
        library(renv)
        cat("RENV_VERSION:", as.character(packageVersion("renv")), "\n")
    thread: r
    assert: "RENV_VERSION: 1.1.4"

  - name: "Initialize renv project"
    run: |
      renv::init(bare = TRUE, restart = FALSE)
      cat("Files created:", paste(list.files("."), collapse=", "), "\n")
    thread: r
    assert: "Files created: renv"

  - name: "Install packages and create lockfile"
    run: |
      renv::install(c("dplyr", "ggplot2", "jsonlite"), prompt = FALSE)
      renv::snapshot(prompt = FALSE)
      if (file.exists("renv.lock")) {
          cat("renv.lock exists and is readable")
      }
      writeLines("source(\"renv/activate.R\")", ".Rprofile")
    thread: r
    assert: "renv.lock exists and is readable"
  
  - name: "restart R"
    run: "R"
    thread: r
    restart: true

  - name: "Migrate renv project using rv"  
    run: "rv migrate renv"
    thread: rv
    assert: "renv.lock was successfully migrated to rproject.toml"
