project-dir: stderr-test
config: plan-rproject.toml

test:
  steps:
  - name: "start R"
    run: "R"
    thread: r
    
  - name: "print wd"
    run: |
      cat(basename(getwd()))
    thread: r
    assert: "stderr-test"

  - name: "create empty .Rprofile"
    run: |
      file.create(".Rprofile")
      cat(readLines(".Rprofile"))
    thread: r 
    assert: ""

  - name: "Check repos"
    run: |
        cat(getOption("repos"))
    thread: r

  - name: "run R code"
    run: |
        cat("Hello World")
        message("This is a message")
        warning("This is a warning")
    thread: r
    assert:
      - "Hello World"
      - "This is a message"
      - "This is a warning"

  - name: "rv init"
    run: "rv init"
    thread: rv
    assert: 
      contains: 
        - "WARNING: Could not set default repositories. Set with your company preferred package URL or public url (i.e. `https://packagemanager.posit.co/cran/latest`)"
        - "rv project successfully initialized at ."
      not-contains: "this is not in stdout"
 
